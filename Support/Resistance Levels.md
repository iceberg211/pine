# Support/Resistance Levels 指标

## 概述

这是一个基于Pine Script v6开发的智能支撑阻力位指标，能够自动识别并绘制图表上的关键价格水平。该指标采用价格聚集度分析算法，通过统计历史转折点的分布密度来确定真正有效的支撑阻力位。

## 核心原理

### 1. 转折点识别机制

```pinescript
ph = ta.pivothigh(rb, rb)  // rb = 10
pl = ta.pivotlow(rb, rb)
```

- **回溯期设置**：使用10个K线作为回溯期（前后各10根）
- **局部极值确认**：只有当价格在前后10根K线中都是最高/最低时，才被认定为有效转折点
- **噪音过滤**：有效避免小幅波动造成的误判

### 2. 价格聚集度分析算法

这是指标的核心算法，本质上是一个**价格密度聚类模型**：

#### 算法步骤

1. **扫描范围设定**
   - `prd = 284`：向前扫描284根K线的历史数据
   - `ChannelW = 10`：通道宽度为价格波动范围的10%

2. **价格通道计算**

   ```text
   通道宽度 = (284根K线最高价 - 最低价) × 10% 
   上边界 = 转折点价格 + 通道宽度
   下边界 = 转折点价格 - 通道宽度
   ```

3. **聚集度统计**
   - 对每个潜在的支撑阻力位，统计落在其价格通道内的历史转折点数量
   - 只有测试点数量 ≥ 强度参数(strengthSR)的价位才被认定为有效

4. **有效性验证**
   - **数量过滤**：至少需要2个测试点（可调）
   - **时间过滤**：最多处理40个转折点
   - **存储限制**：最多保存21个有效支撑阻力位

### 3. 动态颜色系统

```pinescript
line_col = close >= sr_level ? colorSup : colorRes
```

- 当前价格 ≥ 支撑阻力位 → 显示支撑色（绿色）
- 当前价格 < 支撑阻力位 → 显示阻力色（红色）
- 实时反映价位的支撑/阻力属性变化

### 4. 区域化显示

- 支撑阻力位不是单一价格线，而是价格区域
- 区域宽度基于300根K线的价格波动计算
- 使用半透明填充增强视觉效果

## 参数设置

### 基础参数

- **SR On/Off**：开启/关闭支撑阻力位显示
- **Support Color**：支撑位颜色（默认绿色）
- **Resistance Color**：阻力位颜色（默认红色）
- **S/R Strength**：支撑阻力位强度要求（默认2，建议范围1-5）
- **Line Style**：线条样式（实线/虚线/点线）
- **S/R Line Width**：线条宽度

### 高级参数

- **Zones On/Off**：开启/关闭价格区域显示
- **High Low Zones On/Off**：开启/关闭最高最低价区域
- **Zone Width %**：区域宽度百分比（默认1%）
- **Expand SR**：是否延伸支撑阻力线到图表边缘

## 使用方法

### 1. 基本用法

1. **添加指标**：在TradingView中添加此Pine Script指标
2. **调整参数**：根据交易风格调整强度参数和显示选项
3. **观察价位**：关注价格接近支撑阻力位时的反应

### 2. 参数优化建议

#### 根据交易风格调整

**日内交易者**：

- S/R Strength: 3-4（提高过滤强度）
- Zone Width: 0.5-1%（较窄的区域）
- 适用时间框架：1分钟-15分钟

**波段交易者**：

- S/R Strength: 2-3（当前默认设置）
- Zone Width: 1-2%（标准区域宽度）
- 适用时间框架：1小时-日线

**长期投资者**：

- S/R Strength: 2（识别更多重要位）
- Zone Width: 2-3%（较宽的区域）
- 适用时间框架：日线-周线

#### 根据市场波动性调整

**高波动市场**：

- 提高S/R Strength到3-4
- 增加Zone Width到2-3%
- 使用较粗的线条宽度

**低波动市场**：

- 降低S/R Strength到1-2
- 减少Zone Width到0.5-1%
- 可以使用较细的线条

### 3. 交易应用

#### 入场时机

- **做多信号**：价格在支撑位附近获得支撑时考虑买入
- **做空信号**：价格在阻力位附近遇阻时考虑卖出
- **突破确认**：价格有效突破重要支撑阻力位后的跟进机会

#### 风险管理

- **止损设置**：在支撑位下方或阻力位上方设置止损
- **目标价位**：以下一个阻力位或支撑位作为获利目标
- **仓位管理**：在关键价位附近减少仓位或分批建仓

#### 趋势判断

- **上升趋势**：价格连续突破阻力位，旧阻力变新支撑
- **下降趋势**：价格连续跌破支撑位，旧支撑变新阻力
- **震荡市场**：价格在支撑阻力区间内反复波动

## 技术特点

### 优势

1. **智能识别**：基于统计学原理自动识别有效价位
2. **自适应性**：根据价格波动自动调整区域宽度
3. **视觉直观**：颜色和区域显示让关键价位一目了然
4. **历史验证**：基于大量历史数据确保可靠性
5. **实时更新**：随市场变化实时调整价位

### 注意事项

1. **滞后性**：转折点确认需要20根K线（前后各10根）
2. **参数敏感**：不同市场和时间框架需要调整参数
3. **配合使用**：建议与其他技术指标结合使用
4. **市场适应**：在趋势强劲时支撑阻力可能失效

## 算法创新点

1. **价格聚集度分析**：不同于传统的简单高低点识别，使用密度聚类方法
2. **动态通道宽度**：基于历史波动率自动调整价位有效范围
3. **多重过滤机制**：通过数量、时间、存储三重过滤确保质量
4. **实时颜色变化**：直观反映当前价格与关键位的相对关系

## 版本信息

- **Pine Script版本**：v6
- **指标类型**：覆盖型指标(overlay = true)
- **适用平台**：TradingView

## 技术支持

如需技术支持或有改进建议，请通过以下方式联系：

- 检查参数设置是否适合当前市场
- 尝试调整强度参数和区域宽度
- 考虑切换到不同时间框架进行验证

---

*本指标仅供技术分析参考，不构成投资建议。交易有风险，投资需谨慎。*